<div class="audit-logs-container">
  <!-- Header -->
  <header class="audit-header">
    <div class="header-content">
      <h1 class="page-title">Audit Logs</h1>
      <div class="header-actions">
        @if (currentUser) {
          <div class="user-info">
            <span class="user-email">{{ currentUser.email }}</span>
            <span [class]="'role-badge ' + getRoleBadgeClass(currentUser.role)">
              {{ currentUser.role }}
            </span>
          </div>
        }
        <button class="btn-secondary" (click)="goToDashboard()">
          Back to Dashboard
        </button>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="audit-main">
    <!-- Error Message -->
    @if (errorMessage) {
      <div class="error-banner">
        {{ errorMessage }}
      </div>
    }

    <!-- Filters Section -->
    <div class="filters-section">
      <h2 class="section-title">Filters</h2>
      <div class="filters-grid">
        <div class="filter-group">
          <label for="filterAction">Action</label>
          <select
            id="filterAction"
            [(ngModel)]="filterAction"
            class="filter-input"
          >
            <option value="">All Actions</option>
            <option value="LOGIN">Login</option>
            <option value="LOGIN_FAILED">Login Failed</option>
            <option value="TASK_CREATE">Task Create</option>
            <option value="TASK_READ">Task Read</option>
            <option value="TASK_UPDATE">Task Update</option>
            <option value="TASK_DELETE">Task Delete</option>
            <option value="USER_CREATE">User Create</option>
            <option value="USER_UPDATE">User Update</option>
            <option value="USER_DELETE">User Delete</option>
            <option value="ACCESS_DENIED">Access Denied</option>
            <option value="PERMISSION_DENIED">Permission Denied</option>
          </select>
        </div>

        <div class="filter-group">
          <label for="filterResource">Resource</label>
          <select
            id="filterResource"
            [(ngModel)]="filterResource"
            class="filter-input"
          >
            <option value="">All Resources</option>
            <option value="task">Task</option>
            <option value="user">User</option>
            <option value="organization">Organization</option>
            <option value="auth">Auth</option>
          </select>
        </div>

        <div class="filter-group">
          <label for="filterStartDate">Start Date</label>
          <input
            type="date"
            id="filterStartDate"
            [(ngModel)]="filterStartDate"
            class="filter-input"
          />
        </div>

        <div class="filter-group">
          <label for="filterEndDate">End Date</label>
          <input
            type="date"
            id="filterEndDate"
            [(ngModel)]="filterEndDate"
            class="filter-input"
          />
        </div>

        <div class="filter-group">
          <label for="filterLimit">Limit</label>
          <select
            id="filterLimit"
            [(ngModel)]="filterLimit"
            class="filter-input"
          >
            <option [value]="50">50</option>
            <option [value]="100">100</option>
            <option [value]="250">250</option>
            <option [value]="500">500</option>
          </select>
        </div>
      </div>

      <div class="filter-actions">
        <button class="btn-primary" (click)="applyFilters()">
          Apply Filters
        </button>
        <button class="btn-secondary" (click)="clearFilters()">
          Clear Filters
        </button>
      </div>
    </div>

    <!-- Loading State -->
    @if (isLoading) {
      <div class="loading-container">
        <div class="spinner"></div>
        <p>Loading audit logs...</p>
      </div>
    }

    <!-- Audit Logs Table -->
    @if (!isLoading && filteredLogs.length > 0) {
      <div class="table-container">
        <table class="audit-table">
          <thead>
            <tr>
              <th>Timestamp</th>
              <th>User</th>
              <th>Role</th>
              <th>Action</th>
              <th>Resource</th>
              <th>Resource ID</th>
              <th>IP Address</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            @for (log of filteredLogs; track log.id) {
              <tr>
                <td class="timestamp-cell">{{ formatDate(log.createdAt) }}</td>
                <td class="user-cell">{{ log.userEmail }}</td>
                <td>
                  <span [class]="'role-badge-small ' + getRoleBadgeClass(log.userRole)">
                    {{ log.userRole }}
                  </span>
                </td>
                <td>
                  <span [class]="'action-badge ' + getActionBadgeClass(log.action)">
                    {{ log.action }}
                  </span>
                </td>
                <td class="resource-cell">{{ log.resource }}</td>
                <td class="resource-id-cell">
                  {{ log.resourceId ? (log.resourceId.substring(0, 8) + '...') : '-' }}
                </td>
                <td class="ip-cell">{{ log.ipAddress || '-' }}</td>
                <td>
                  @if (log.details?.statusCode) {
                    <span
                      [class]="'status-badge ' + (log.details.statusCode >= 400 ? 'status-error' : 'status-success')"
                    >
                      {{ log.details.statusCode }}
                    </span>
                  } @else {
                    <span class="status-badge status-default">-</span>
                  }
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>

      <div class="table-footer">
        <p class="records-count">Showing {{ filteredLogs.length }} records</p>
      </div>
    }

    <!-- Empty State -->
    @if (!isLoading && filteredLogs.length === 0) {
      <div class="empty-state">
        <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
          <polyline points="14 2 14 8 20 8"></polyline>
          <line x1="16" y1="13" x2="8" y2="13"></line>
          <line x1="16" y1="17" x2="8" y2="17"></line>
          <polyline points="10 9 9 9 8 9"></polyline>
        </svg>
        <h3>No Audit Logs Found</h3>
        <p>No logs match your current filters. Try adjusting the filters or clearing them.</p>
      </div>
    }
  </main>
</div>
